<div class="profile-page">
  @if (profile | async) {
    <mat-card class="profile-card">
      <!-- Profile Avatar -->
      <div class="profile-header">
        <img
          [ngSrc]="(profile | async)?.avatar || 'favicon.ico'"
          alt="User Avatar"
          class="profile-avatar"
          width="50"
          height="150"
        />
       @if(edit) {
          <button
            mat-raised-button
            color="primary"
            class="change-photo-btn"
            (click)="changePhoto.click()"
            >
            Change Photo
          </button>
         <input
           type="file"
           accept="image/*"
           #changePhoto
           style="display: none"
           (change)="onPhotoChange($event)"
           />
       }
      </div>

      <!-- Profile Details -->
      <mat-card-content>
        <!-- Username -->
        <mat-form-field appearance="fill" class="edit-input">
          <mat-label>Username</mat-label>
          <input
            matInput
            [value]="(profile | async)?.name"
            [disabled]="!edit"
            required
            class="edit-input"
            placeholder="Edit your username"
            #usernameInput
          />
          <mat-icon matSuffix>highlight_off</mat-icon>
          @if (edit && !usernameInput.value) {
            <mat-error>Username is required.</mat-error>
          }
        </mat-form-field>

        <!-- Email -->
        <mat-form-field appearance="fill" class="edit-input">
          <mat-label>Email</mat-label>
          <input
            matInput
            [value]="(profile | async)?.email"
            [disabled]="!edit"
            required
            class="edit-input"
            placeholder="Edit your email"
            #emailInput
          />
          <mat-icon matSuffix>highlight_off</mat-icon>
          @if (edit && !emailInput.value) {
            <mat-error>Email is required.</mat-error>
          }
          @if (emailError) {
            <mat-error>{{ emailError }}</mat-error>
          }
        </mat-form-field>

        <!-- Password -->
        <mat-form-field appearance="fill" class="edit-input">
          <mat-label>Password</mat-label>
          <input
            matInput
            [value]="(profile | async)?.password"
            [disabled]="!edit"
            required
            minlength="8"
            class="edit-input"
            placeholder="Edit your password"
            type="password"
            #passwordInput
          />
          <mat-icon matSuffix>highlight_off</mat-icon>
          @if (edit && !passwordInput.value) {
            <mat-error>Password is required.</mat-error>
          }
          @if (edit && passwordInput.value.length < 8) {
            <mat-error>Password must be at least 8 characters long.</mat-error>
          }
        </mat-form-field>
      </mat-card-content>

      <!-- Editable Input -->
      <mat-card-actions>
        <button mat-raised-button (click)="toggleEdit()">
          <mat-icon>keyboard</mat-icon>
          {{ !edit ? 'Edit' : 'Save' }}
        </button>
      </mat-card-actions>
    </mat-card>
  }
</div>
